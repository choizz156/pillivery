# ìµœë¯¼ì„ | ë°±ì—”ë“œ ê°œë°œì
ğŸ“© E-mail : [choizz156@gmail.com](choizz156@gmail.com)

ğŸ“š Blog: https://choizz.tistory.com

---
> **ë¶€íŠ¸ìº í”„ í”„ë¡œì íŠ¸ë¥¼ ì‹¤ìš´ì˜ ìˆ˜ì¤€ìœ¼ë¡œ**
> 
> ë¶€íŠ¸ìº í”„ íŒ€ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì£¼ë¡œ ê¸°ëŠ¥ êµ¬í˜„ì—ë§Œ ì§‘ì¤‘í–ˆìŠµë‹ˆë‹¤.
> í•˜ì§€ë§Œ ì‹¤ì œ ì„œë¹„ìŠ¤ ìš´ì˜ì—ëŠ” ì„±ëŠ¥, ì•ˆì •ì„±, ê´€ë¦¬ê°€ í•„ìš”í•˜ë‹¤ëŠ” ê²ƒì„ ì•Œì•˜ìŠµë‹ˆë‹¤.
> ì´ì— í•´ë‹¹ í”„ë¡œì íŠ¸ë¥¼ ì‹¤ìš´ì˜ ìˆ˜ì¤€ìœ¼ë¡œ ê°œì„ í•´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. ì „ì²´ ë„ë©”ì¸ êµ¬ì¡°ì™€ ì„œë²„ ë¡œì§ì„ íŒŒì•…í•œ í›„, ê°œì¸ì ìœ¼ë¡œ ì‹œìŠ¤í…œ ì „ë°˜ì„ ë¦¬íŒ©í† ë§í•˜ê³  ê°œì„ í–ˆìŠµë‹ˆë‹¤.
> ê·¸ ê²°ê³¼ ë„ë©”ì¸ ì„¤ê³„ ê°œì„ , ì„±ëŠ¥ ìµœì í™”, CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•, ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ë„ì… ë“±ì„ ê²½í—˜í•˜ë©° ì‹¤ë¬´ì— í•„ìš”í•œ ê¸°ìˆ ë“¤ì„ í•™ìŠµí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

# Pillivery (ì§€ì†ì  ê°œë°œ ë° ê°œì„ : 2022 - í˜„ì¬)
- PilliveryëŠ” ê±´ê°•ê¸°ëŠ¥ì‹í’ˆ ì˜¨ë¼ì¸ ì£¼ë¬¸ ë° ì •ê¸° ê²°ì œ/ë°°ì†¡ í”Œë«í¼ìœ¼ë¡œ, ì´ˆê¸° íŒ€ í”„ë¡œì íŠ¸ ì´í›„ ê°œì¸ì ìœ¼ë¡œ ì‹¤ì œ ì„œë¹„ìŠ¤ ìˆ˜ì¤€ì˜ ì•„í‚¤í…ì³ì™€ ì„±ëŠ¥ì„ ëª©í‘œë¡œ ì§€ì† ê°œì„  ì¤‘
- ê±´ê°•ê¸°ëŠ¥ì‹í’ˆ ì˜¨ë¼ì¸ ì£¼ë¬¸ ë° **ì •ê¸° ê²°ì œ/ë°°ì†¡** í”Œë«í¼ì„ ëª©í‘œ
    - ê±´ê°•ê¸°ëŠ¥ì‹í’ˆ ê³µê³µ ë°ì´í„° í™œìš©
- ì‹¤ì œ ì„œë¹„ìŠ¤ ìˆ˜ì¤€ì˜ ê±´ê°•ê¸°ëŠ¥ì‹í’ˆ ì˜¨ë¼ì¸ í”Œë«í¼ êµ¬í˜„(ì‹¤ì œ ì„œë¹„ìŠ¤ X)
- ë¹„ìš© ë¬¸ì œë¡œ í˜„ì¬ ë°°í¬ ì¤‘ë‹¨


## ê¸°ìˆ  ìŠ¤íƒ

### Back-end

| ì¹´í…Œê³ ë¦¬           | ê¸°ìˆ  ìŠ¤íƒ                                                                                    |
|----------------|------------------------------------------------------------------------------------------|
| **ì–¸ì–´ & ë¹Œë“œ ë„êµ¬** | Java 11, Gradle 7.5.1                                                                    |
| **í”„ë ˆì„ì›Œí¬**      | Spring Boot 2.7.5, Spring Data JPA/JDBC, Spring Security, Spring Batch, Spring Rest Docs |
| **ì¸ì¦/ì¸ê°€**      | JWT, OAuth 2.0                                                                           |
| **ë°ì´í„°ë² ì´ìŠ¤**     | MySQL 8.0                                                                                |
| **ìºì‹œ**         | Redis (Redisson), Caffeine Cache                                                         |
| **ì¸í”„ë¼**        | NCP, Vultr, Docker, Jenkins, Nginx, Resilience4j                                         |
| **ëª¨ë‹ˆí„°ë§ & ë¡œê¹…**  | Promtail, Loki, Prometheus, Grafana, cAdvisor                                            |
| **í…ŒìŠ¤íŠ¸**        | JUnit 5, Mockito, WireMock, RestAssured, FixtureMonkey                                   |
| **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸**     | Locust                                                                                   |
| **HTTP í´ë¼ì´ì–¸íŠ¸** | WebClient, RestTemplate                                                                  |
| **ê¸°íƒ€**         | Quartz, EmbeddedRedis                                                                    |

## 1. ê°œì„  ì „ íŒ€ í”„ë¡œì íŠ¸ ì´ˆê¸° ê°œë°œ(2022. 11 ~ 2022.12)

- íŒ€ í”„ë¡œì íŠ¸ ì°¸ì—¬ ì¸ì›: 7ëª…(FE: 4ëª…, BE: 3ëª…)
- 3ì¸ ë°±ì—”ë“œ íŒ€ì—ì„œ **í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„** ë‹´ë‹¹
    
    (1) ì¸ì¦/ì¸ê°€ ì‹œìŠ¤í…œ êµ¬ì¶•(Spring Security, JWT, OAuth 2.0)
    
    (2) ì™¸ë¶€ ê²°ì œ API ì—°ë™ (ì¹´ì¹´ì˜¤í˜ì´)
    
    (3) ì •ê¸° ê²°ì œ ì‹œìŠ¤í…œ êµ¬ì¶•(Quartz)
---

## 2. ê°œì¸ ë¦¬íŒ©í† ë§ ì‘ì—…(~ í˜„ì¬)

### ğŸ“Š í”„ë¡œì íŠ¸ ê°œì„  ì‚¬í•­
```mermaid
graph LR
    A[ì•„í‚¤í…ì²˜ & ì„¤ê³„ ê°œì„ ] --> B[ì‹±ê¸€ ëª¨ë“ˆ]
    B --> C[ë©€í‹° ëª¨ë“ˆ]
    A --> F[JPA ë¶ˆí•„ìš” ì–‘ë°©í–¥ ê´€ê³„]
    F --> G["ë‹¨ë°©í–¥ ê´€ê³„ ì¤‘ì‹¬(ì• ê·¸ë¦¬ê±°íŠ¸, ì´ë²¤íŠ¸)"]
```
```mermaid
graph LR
    A[ê¸°ìˆ  ìŠ¤íƒ ë³€ê²½ & ì„±ëŠ¥ ê°œì„ ]
    A --> C[ë‹¨ìˆœ SQL]
    C --> D[QueryDSL]
    A --> E[Quartz ìŠ¤ì¼€ì¤„ë§]
    E --> F[Quartz + Spring Batch]
    A --> G[ìºì‹± ì „ëµ X]
    G --> H[Redis, Caffeine cache]
    A --> I[API ë™ê¸° ë°©ì‹]
    I --> J[ë¹„ë™ê¸° í†µì‹  ì¶”ê°€]
    A --> K[ì¡°ê±´ì ˆ ì¸ë±ìŠ¤ X]
    K --> L[ì¸ë±ìŠ¤ ì ìš©]
```
```mermaid
graph LR
    A[ì•ˆì •ì„± & í’ˆì§ˆ ê°œì„ ]
    A --> N[api í†µì‹  ì¥ì•  ëŒ€ì‘ X]
    N --> O[Resilience4j ì„œí‚· ë¸Œë ˆì´ì»¤]
    A --> P[ë™ì‹œì„± ì œì–´ X]
    P --> Q[Redis ë¶„ì‚°ë½]
    A --> R[í…ŒìŠ¤íŠ¸ ì½”ë“œ X]
    R --> S[ì•½ 300ê°œì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œ, ì»¤ë²„ë¦¬ì§€ 85%]
    A --> T[ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ X]
    T --> U[Load/Stress í…ŒìŠ¤íŠ¸]
    A --> V[API ë¬¸ì„œ X]
    V --> W[Spring Rest Docs ë„ì…]
```
```mermaid
graph LR
    A[ì¸í”„ë¼ ê°œì„ ]
    A --> N[ë‹¨ì¼ ì„œë²„ ìš´ì˜]
    N --> O["ë‹¤ì¤‘ ì„œë²„ (app ì„œë²„ 2ê°œ + batch 1ê°œ)"]
    A --> P[ìˆ˜ë™ ë°°í¬]
    P --> Q["CI/CD ë¬´ì¤‘ë‹¨ ë°°í¬(Jenkins)"]
    A --> R[ë¡œë“œ ë°¸ëŸ°ì„œ X]
    R --> S[ë¡œë“œ ë°¸ëŸ°ì„œ ë„ì…]
    A --> T[ì»¨í…Œì´ë„ˆ x]
    T --> U[docker ê¸°ë°˜ ë°°í¬]
```
### **2.1 ì‹±ê¸€ ëª¨ë“ˆ â†’ ë©€í‹° ëª¨ë“ˆ ì „í™˜ì„ í†µí•œ ë¹Œë“œ ì‹œê°„ ë‹¨ì¶•ê³¼ í™•ì¥ì„± í™•ë³´**

- ë¹Œë“œ ì‹œê°„ ë‹¨ì¶•**(ì „ì²´ ë¹Œë“œ ì‹œê°„ 110s â†’ API ëª¨ë“ˆ 54s, Batch ëª¨ë“ˆ 25s)**
- **ëª¨ë“ˆ ê°„ ê²°í•©ë„ ìµœì†Œí™”ë¡œ í™•ì¥ì„± ê³ ë ¤**
- **ë‹¨ë°©í–¥ìœ¼ë¡œ ì˜ì¡´ì„± ê´€ë¦¬**
  ![](https://github.com/choizz156/pillivery/blob/1c8914e993f8ad06561b388b1beb4cd805364d19/image/%E1%84%86%E1%85%A9%E1%84%83%E1%85%B2%E1%86%AF%E1%84%8B%E1%85%B4%E1%84%8C%E1%85%A9%E1%86%AB%E1%84%83%E1%85%A9%20333.png)

#### 2.1.1 ëª¨ë“ˆ ì¢…ë¥˜

    â”œâ”€â”€ module-api : ì‚¬ìš©ì API ë¡œì§
    â”œâ”€â”€ module-batch : ì •ê¸° ê²°ì œ batch ë¡œì§
    â”œâ”€â”€ module-core : ë„ë©”ì¸ ë° ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§
    â”œâ”€â”€ module-event : ì´ë²¤íŠ¸ ì €ì¥ ë° ë°œí–‰ ë¡œì§
    â”œâ”€â”€ module-external-api :ì™¸ë¶€ API í†µì‹  ë¡œì§
    â”œâ”€â”€ module-logging : ë¡œê¹… ê´€ë ¨ ê³µí†µ ëª¨ë“ˆ
    â”œâ”€â”€ module-redis : ë¶„ì‚° ë½, refresh token ë¡œì§

### 2.2 ERD ë° ì»¤ë„¥ì…˜ í’€ ì„¤ì •
ë„ë©”ì¸ íŠ¹ì„± ìƒ ì¹´í…Œê³ ë¦¬ ë³€ê²½ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ì ë‹¤ëŠ” íŒë‹¨ í•˜ì— AttributeConverterë¥¼ ì‚¬ìš©í•˜ì—¬ í•œ ì»¬ëŸ¼ì— ë‹¤ì¤‘ ì¹´í…Œê³ ë¦¬ ì†ì„± ì €ì¥
<img width="201" height="146" alt="image" src="https://github.com/user-attachments/assets/f0a864a9-11d5-416f-9091-65f756781528" />

- category í…Œì´ë¸”ê³¼ ì—°ê´€ê´€ê³„ ì œê±° â†’ category í…Œì´ë¸”ê³¼ join í•˜ì§€ ì•ŠìŒ
- JPAì˜ @ElementCollectionì„ ì´ìš©í•œ item_category ìƒì„±

#### 2.2.1 ë…¼ë¦¬ì  ERD
![](https://github.com/choizz156/pillivery/blob/1c8914e993f8ad06561b388b1beb4cd805364d19/image/%E1%84%82%E1%85%A9%E1%86%AB%E1%84%85%E1%85%B5%E1%84%8C%E1%85%A5%E1%86%A8%20erd.png)

#### 2.2.2 HikariCP ì„¤ì •

- MySQL ì»¤ë„¥ì…˜ ì„¤ì •ë³´ë‹¤ ë‚®ê²Œ ì„¤ì •ë¼ìˆëŠ” ê²ƒì€ ê¸°ë³¸ê°’ì„ ì‚¬ìš©
  - ìµœëŒ€ ì»¤ë„¥ì…˜ í’€ í¬ê¸°, ìµœì†Œ ìœ íœ´ ì»¤ë„¥ì…˜ ê°œìˆ˜, ìµœëŒ€ ìœ íœ´ ì‹œê°„, ìµœëŒ€ ìœ ì§€ ì‹œê°„, ìœ íš¨ì„± ê²€ì‚¬ ì£¼ê¸°
- ì»¤ë„¥ì…˜ ëŒ€ê¸° ì‹œê°„(connection-timeout): HikariCP ê¸°ë³¸ê°’(30ë¶„)ë³´ë‹¤ ë‚®ì€ 3ì´ˆë¡œ ì„¤ì •í•˜ì—¬ ìœ ì €ì—ê²Œ ë¹ ë¥¸ í”¼ë“œë°±
  


### 2.3 ì¸í”„ë¼ ì•„í‚¤í…ì²˜ ë° ë°°í¬ ê°œì„ 

> Client â†’ EC2 â†’ RDSì˜ ë‹¨ìˆœ 3-tier â†’ í™•ì¥ì„±ê³¼ ìš´ì˜ íš¨ìœ¨ì„±ì„ ê³ ë ¤í•œ ì•„í‚¤í…ì²˜ë¡œ ê°œì„ 

- êµ¬ì„±

    - private ì„œë¸Œë„·: ë¹„ì¦ˆë‹ˆìŠ¤ ì„œë²„ 2ê°œ, ë°°ì¹˜ ì„œë²„ 1ê°œ, DB ì„œë²„ 1ê°œ
    - public ì„œë¸Œë„·: ë¡œë“œ ë°¸ëŸ°ì„œ, Bastion ì„œë²„, ëª¨ë‹ˆí„°ë§ ì„œë²„
    - Bastion ì„œë²„ë¥¼ í†µí•œ private ì„œë²„ ê´€ë¦¬


![ì•„ì¼€íƒì³](https://github.com/choizz156/pillivery/blob/5d60e935f2e10eccda9f9f00ec5c590df81b1f1d/image/%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A7%20%E1%84%8C%E1%85%B5%E1%86%AB%E1%84%8D%E1%85%A1%20%E1%84%8E%E1%85%AC%E1%84%8C%E1%85%A9%E1%86%BC.png)


#### 2.3.1 ì•„í‚¤í…ì²˜ ê°œì„ 

**(1) ë³´ì•ˆì„± ê°•í™”**

- Bastion Host ë„ì…
  - ì„œë¹„ìŠ¤ ì •ìƒ íŠ¸ë˜í”½ê³¼ ê´€ë¦¬ììš© íŠ¸ë˜í”½ì„ ë¶„ë¦¬
  - í„°ë¯¸ë„ ì ‘ê·¼ì„ ìœ„í•œ í‚¤ ê´€ë¦¬, ì‘ì—… ê°ì‚¬ë¡œê·¸ ìˆ˜ì§‘ ë° ë³´ì•ˆ êµ¬ì„±
  - ì•…ì„±ì½”ë“œ ê°ì—¼ ì‹œì—ë„ Bastionë§Œ ì¬êµ¬ì„±í•˜ë©´ ë˜ë¯€ë¡œ ì„œë¹„ìŠ¤ ì˜í–¥ ìµœì†Œí™”



**(2) íŠ¸ë˜í”½ ë¶„ì‚° ë° ì•ˆì •ì„±** 

- ë¡œë“œë°¸ëŸ°ì„œ(ALB) ì ìš©
  - ë¡œë“œë°¸ëŸ°ìŠ¤ ì„œë¸Œë„·ë§Œ í¬íŠ¸ ê°œë°©(443/80) â†’ Nginx/WASëŠ” Private Subnetì— ê²©ë¦¬
  - ìµœì†Œ ì—°ê²° ìˆ˜ ê¸°ë°˜ íŠ¸ë˜í”½ ë¶„ì‚°
  - SSL/TLS Offlodingìœ¼ë¡œ ì•”í˜¸í™” ì˜¤ë²„í—¤ë“œ ì œê±°
  - í—¬ìŠ¤ì²´í¬ë¡œ Nginx ì¥ì•  ì‹œ íŠ¸ë˜í”½ ì „ë‹¬ ì¤‘ë‹¨í•˜ì—¬ ì¥ì•  ì „íŒŒ ë°©ì§€
    
 
**(3) Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì ìš©**

- Sticky Session ì ìš©
  - ì¥ë°”êµ¬ë‹ˆ API ê²½ë¡œì— ì ìš©
  - ìºì‹œì— ì €ì¥ë¼ìˆëŠ” ë°ì´í„° ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²°

    <details>
      <summary>ì„¤ì •</summary>
        
    ```bash
    
        # ... ìƒëµ
        
          upstream app_sticky {
                server <app ì„œë²„ 1 ip>:8080;
                server <app ì„œë²„ 2 ip>:8080;
                sticky name=srv_id expires=1h domain=pillivery path=/api/carts;
                keepalive 10;
            }
        
        server {
          listen 80;
          location ^~ /api/carts {
              proxy_pass http://app_sticky;
         			#... ìƒëµ
          }
        }
        
        #... ìƒëµ
    
    ```
    </details>

- IP ì ‘ê·¼ ì œí•œ
  - ì •ê¸° ê²°ì œ ìŠ¹ì¸ APIì—ì„œ  IPë¥¼ ë‚´ë¶€ ì„œë²„ IPë§Œìœ¼ë¡œ ì œí•œ


     <details>
          <summary>ì„¤ì •</summary>
            
     ```bash
        
            # ... ìƒëµ
            
              upstream app_sticky {
                    server <app ì„œë²„ 1 ip>:8080;
                    server <app ì„œë²„ 2 ip>:8080;
                    sticky name=srv_id expires=1h domain=pillivery path=/api/carts;
                    keepalive 10;
                }
            
            server {
              listen 80;
              location ^~ /api/carts {
                  proxy_pass http://app_sticky;
             			#... ìƒëµ
              }
            }
            
            #... ìƒëµ
        
    ```
    </details>
    
- ì„±ëŠ¥ ìµœì í™”
    - ë„¤íŠ¸ì›Œí¬ ë¶€í•˜ ê°ì†Œë¥¼ ìœ„í•œ Json ì‘ë‹µì„ gzipë¡œ ì••ì¶•


**(4) ë¹„ìš© ìµœì í™”**

- Lamda, NCP APIë¥¼ í†µí•œ Batch Server ê°€ë™
  - ë°°ì¹˜ ì‘ì—… ì‹œì—ë§Œ NCP APIë¡œ Batch Server VMì„ ì‘ë™ì‹œì¼œ ë¹„ìš© ìµœì†Œí™”
  - Lamda, EventBridgeìœ¼ë¡œ cron ìŠ¤ì¼€ì¤„ë§ì„ ì„¤ì •
  - NCP APIë¥¼ í˜¸ì¶œí•˜ì—¬ Batch ì„œë²„ VMì„ ì‘ë™
  - ì •ìƒ ì¢…ë£Œ ì‹œ VM ë‚´ë¶€ì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ì¢…ë£Œ
  - Error ë¡œê·¸ë¥¼ í†µí•œ ì¦‰ê°ì ì¸ ì•ŒëŒ ì„¤ì •

<details>
  <summary>ìŠ¤í¬ë¦½íŠ¸</summary>
            
     ```bash
        
            #!/bin/bash

            LOG_FILE="/var/log/app_execution.log"
            
            log_message() {
            local timestamp=$(date "+%Y-%m-%d %H:%M:%S")
            echo "[$timestamp] $1" >> $LOG_FILE
            echo "[$timestamp] $1"
            }
            
            JAR_FILE="/root/module-batch-boot.jar"
            PROFILE="batch"
            
            log_message "ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ì‹œì‘"
            java -jar -Dspring.profiles.active=$PROFILE $JAR_FILE
            
            EXIT_CODE=$?
            log_message "ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì½”ë“œ: $EXIT_CODE"
            
            if [ $EXIT_CODE -eq 0 ]; then
            log_message "ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. VM ì¢…ë£Œë¥¼ ì§„í–‰í•©ë‹ˆë‹¤."
            sudo shutdown -h now
            else
            log_message "batch ì—ëŸ¬ ë°œìƒ - í™•ì¸ í•„ìš”"
            fi
            
            log_message "ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì™„ë£Œ"
            exit 0    

        
    ```
    </details>


#### 2.3.2 ë°°í¬ ê°œì„  ë° CI/CD ì ìš©

**(1) ì»¨í…Œì´ë„ˆí™”** 

- Docker ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ
- ë¹Œë“œ í™˜ê²½ê³¼ ì‹¤í–‰ í™˜ê²½ ë¶„ë¦¬(ê²½ëŸ‰í™”ëœ JRE í™˜ê²½ì—ì„œë§Œ ì‹¤í–‰)
- ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ í¬ê¸° 56% ìµœì í™” (1.2GB â†’ 531.5MB, ì•½ 56%)
- ì¸í”„ë¼ í™˜ê²½ì˜ ì¼ê´€ì„± í™•ë³´

<details>
      <summary>api.dockerfile</summary>
            
     ```dockerfile
        
          FROM gradle:jdk11 AS build

          WORKDIR /app

          COPY --chown=gradle:gradle build.gradle settings.gradle gradlew ./
          COPY --chown=gradle:gradle gradle/ ./gradle/
          COPY --chown=gradle:gradle deploy_script/ ./deploy_script/ #(ë°°í¬ ìŠ¤í¬ë¦½íŠ¸)
          COPY --chown=gradle:gradle . .
        
          RUN ./gradlew clean :module-api:build --parallel
        
        
          FROM openjdk:11.0.16-jre-slim-buster
          
          WORKDIR /app
          
          COPY --from=build /app/module-api/build/libs/module-api-boot.jar app.jar
        
          ENTRYPOINT ["java", "-jar", "-Dspring.profiles.active=prod", "app.jar"]

        
    ```
</details>

<details>
  <summary>batch.dockerfile</summary>
            
     ```dockerfile
        
           FROM gradle:jdk11 AS build

          WORKDIR /app
    
          COPY --chown=gradle:gradle build.gradle settings.gradle gradlew ./
          COPY --chown=gradle:gradle gradle/ ./gradle/
          COPY --chown=gradle:gradle deploy_script/ ./deploy_script/
          COPY --chown=gradle:gradle . .
        
          RUN ./gradlew clean :module-batch:build --parallel
        
        
          FROM openjdk:11.0.16-jre-slim-buster
        
          WORKDIR /app
        
          COPY --from=build /app/module-api/build/libs/module-batch-boot.jar app.jar
        
          ENTRYPOINT ["java", "-jar", "-Dspring.profiles.active=batch", "app.jar"]
        
    ```
</details>

**(2) ë¬´ì¤‘ë‹¨ CI/CD íŒŒì´í”„ë¼ì¸(Rolling)**

> **ê¸°ìˆ  ì„ íƒ ì´ìœ **
>
> - **Jenkins:** business, batch ë‘ ê°œì˜ íŒŒì´í”„ë¼ì¸ ì„¤ì • í•„ìš”ì„±
> - **Docker, Container Registry:** Container Registryë¥¼ í†µí•œ **ë„ì»¤ ì´ë¯¸ì§€ ë²„ì „ ê´€ë¦¬** ê°€ëŠ¥

- **ë‚´ìš©**
  - Bastion í˜¸ìŠ¤íŠ¸ë¥¼ í†µí•œ Private ì„œë¸Œë„· ë°°í¬
  - ë¹Œë“œ ì‹œ í…ŒìŠ¤íŠ¸(CI), ë°°í¬ í›„ í—¬ìŠ¤ ì²´í¬(CD)
  - Slackì„ í†µí•œ ë°°í¬ ì•ŒëŒ ì„¤ì •


- **Jenkins Pipeline stage ì¢…ë¥˜**

  - check out

  - git ì •ë³´ ë° í™˜ê²½ ì„¤ì •

  - Docker ì´ë¯¸ì§€ ë¹Œë“œ(CI)

  - Docker ì´ë¯¸ì§€ Container Registryì— í‘¸ì‹œ

  - ì„œë²„ë‚´ ìŠ¤í¬ë¦½íŠ¸ë¡œ ë°°í¬ ë° í—¬ìŠ¤ ì²´í¬(CD)

  - Slack ì•ŒëŒ(ì„±ê³µ/ì‹¤íŒ¨)



